(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{668:function(e,t,a){"use strict";a(678);var n=a(679),o=a.n(n),s=(a(686),a(687)),r=a.n(s),c=a(24),i=a(28),l=a(26),u=a(25),d=a(27),m=a(163),p=a.n(m),h=a(226),v=a.n(h),b=a(3),g=a.n(b),f=a(0),O=a.n(f),k=a(22),j=a(17),y=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props,t=e.agent,a=e.size,n=e.showOffline,o=e.className,s=a||20,c=s/2,i=Math.pow((Math.pow(Math.pow(c,2)+Math.pow(c,2),.5)-c)/2,.5)+4;return g()(t,"online")&&!g()(t,"isAway")?O.a.createElement(r.a,{status:"success",offset:[-i,s-i],className:"online-badge"},this.renderAvatar()):n?O.a.createElement(r.a,{status:"warning",offset:[-i,s-i],className:"online-badge "+(o||"")},this.renderAvatar()):O.a.createElement("div",null,this.renderAvatar())}},{key:"renderAvatar",value:function(){var e=this.props,t=e.noDefault,a=e.agent,n=e.size,s=e.className,r=e.color,c=e.app,i=j.c.getAvatarCharacters(a),l=g()(a,"profilePicture");return a||t||(l=g()(c,"logo"),i=v()(p()(g()(c,"name")))),l?O.a.createElement(o.a,{className:s||"agent-avatar",src:j.c.getProfilePicture(l),size:n||20}):O.a.createElement(o.a,{className:s||"agent-avatar",style:{backgroundColor:r||j.c.getColor(i)},size:n||20},i)}}]),t}(O.a.Component);t.a=Object(k.connect)(function(e){return{app:e.common.app}})(y)},946:function(e,t,a){var n=a(947),o=a(948),s=a(38);e.exports=function(e,t){return e&&e.length?n(e,s(t,2),o):void 0}},947:function(e,t,a){var n=a(82);e.exports=function(e,t,a){for(var o=-1,s=e.length;++o<s;){var r=e[o],c=t(r);if(null!=c&&(void 0===i?c===c&&!n(c):a(c,i)))var i=c,l=r}return l}},948:function(e,t){e.exports=function(e,t){return e>t}},993:function(e,t,a){"use strict";a.r(t);var n=a(2),o=a(21),s=a.n(o),r=a(50),c=a(24),i=a(28),l=a(26),u=a(25),d=a(27),m=a(5),p=a(10),h=a(57),v=a.n(h),b=a(23),g=a.n(b),f=a(36),O=a.n(f),k=a(47),j=a.n(k),y=a(220),C=a.n(y),E=a(946),N=a.n(E),w=a(19),I=a.n(w),F=a(34),A=a.n(F),S=a(115),H=a.n(S),M=a(11),T=a.n(M),R=a(3),P=a.n(R),B=a(0),L=a.n(B),_=a(22),x=a(17),D=a(13),U=a(15),z=a.n(U),V=a(1),q=a(222),J=a(668),G=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleImageLoaded=a.handleImageLoaded.bind(Object(m.a)(Object(m.a)(a))),a.image=L.a.createRef(),a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"handleImageLoaded",value:function(){this.props.sendHeightPopup()}},{key:"renderPhoto",value:function(e,t){return L.a.createElement("img",{alt:"",key:t,className:"content-item image",src:e.content,ref:this.image,onLoad:this.handleImageLoaded})}},{key:"renderFile",value:function(e,t){return L.a.createElement("a",{key:t,href:e.content,className:"content-item file-attachment",target:"_blank",rel:"noopener noreferrer"},L.a.createElement("span",null,e.name||e.content))}},{key:"_getVideoLink",value:function(e){return P()(e,"meta.embedLink")||e.content}},{key:"renderVideo",value:function(e,t){var a=this._getVideoLink(e);return L.a.createElement("iframe",{key:t,title:a,src:a,allowFullScreen:!0,frameBorder:"0",allow:"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture",style:{width:"100%"}})}},{key:"getAuthorName",value:function(e){return"agent"===e.author.type?{name:e.author.firstName,appName:P()(this.props.app,"name")}:"bot"===e.author.type?{name:e.author.name}:{name:""}}},{key:"_mapMessage",value:function(e,t){var a=this.props,n=a.app,o=a.visitor,s=a.runningBots,r=a.customBotsTable,c=a.customFields,i=z()(s,function(e){return t===e.conversationId}),l=V.a.get(r,P()(i,"botId"));return l?(e=Object(x.k)(e,{app:n,visitor:o,creator:l,isReal:!0,customFields:c}),L.a.createElement("span",{className:"content-item",dangerouslySetInnerHTML:{__html:e}})):L.a.createElement("span",{className:"content-item",dangerouslySetInnerHTML:{__html:e}})}},{key:"render",value:function(){var e,t=this,a=this,n=a.props,o=n.message,s=n.app,r=this.getAuthorName(o),c=r.name,i=r.appName;return L.a.createElement("li",{onClick:function(){return a.props.openConversation(o.conversationId)},className:"chat-item "+o.author.type+" ms-status-"+o.status},L.a.createElement("div",{className:"messages-item-inner"},L.a.createElement("div",{className:"avatar-name-msg-item"},L.a.createElement(J.a,{size:32,agent:o.author,className:"messages-item-avatar"}),L.a.createElement("div",{className:"agent-name"},c,i?L.a.createElement("span",null,"\xa0t\u1eeb ",s.name):null)),L.a.createElement("div",{className:"message-content theme-color-bg-non-hover"},I()(o.blocks,function(n,s){return"image"===(e=Object(q.c)(n.contentType))?a.renderPhoto(n,s):"text"===e?n.content&&t._mapMessage(n.content,o.conversationId):"file"===e?a.renderFile(n,s):"video"===e?a.renderVideo(n,s):void 0}))))}}]),t}(L.a.Component),W=Object(_.connect)(function(e){var t=P()(e,"bot.runningBots"),a=V.a.getTable(e,V.a.tableNames.customBots),o=V.a.getTable(e,V.a.tableNames.conversation),s=V.a.getTable(e,V.a.tableNames.customFields);return Object(n.a)({},e.auth,e.conversation,{app:Object(n.a)({},e.common.app),visitor:e.auth.visitor,runningBots:t,customBotsTable:a,conversationsTable:o,customFields:V.a.query(s,{})})},function(e){return{}})(G),K=(a(703),a(709)),Q=a.n(K),X=(a(676),a(672)),Y=a.n(X),Z=(a(704),a(710)),$=a.n(Z),ee=a(29),te=a(718),ae=a.n(te),ne=a(74),oe=function(e){function t(e){var a;return Object(c.a)(this,t),a=Object(l.a)(this,Object(u.a)(t).call(this,e)),Object(p.a)(Object(m.a)(Object(m.a)(a)),"handleImageLoaded",function(){a.state.loaded||(a.props.sendHeightPopup(),a.setState({loaded:!0}))}),Object(p.a)(Object(m.a)(Object(m.a)(a)),"hoverIcon",function(e){a.state.rated||a.setState({activeOrHover:e})}),Object(p.a)(Object(m.a)(Object(m.a)(a)),"onMouseLeave",function(){a.state.rated||a.setState({activeOrHover:null})}),Object(p.a)(Object(m.a)(Object(m.a)(a)),"renderRating",function(e,t){var n=Object(m.a)(Object(m.a)(a)),o=a.props,s=o.app,r=o.visitor,c=o.customFields,i=a.state,l=i.rated,u=i.activeOrHover,d=A()(ne.f,{value:l});if(!T()(d)&&a.state.addedFeedback||!T()(d)&&!t.meta.feedback)return L.a.createElement("span",{className:"rated"},L.a.createElement("span",null,ee.a.t("C\u1ea3m \u01a1n b\u1ea1n \u0111\xe3 \u0111\xe1nh gi\xe1")),L.a.createElement("img",{className:"csat-rate-icon",alt:"",src:d[0].icon,ref:a.image,onLoad:a.handleImageLoaded}));var p=Object(x.k)(e.content,{app:s,visitor:r,creator:{},isReal:!0,customFields:c});return L.a.createElement("div",null,L.a.createElement("div",{className:"label-rating"},L.a.createElement("span",null,p)),L.a.createElement(Q.a,{className:"select-rating",type:"flex",justify:"center",align:"top"},I()(ne.f,function(e){return L.a.createElement(Y.a,{mouseEnterDelay:"0.1",overlayClassName:"tooltip-rate ".concat(l&&"unvisible"),placement:"bottom",title:e.title},L.a.createElement($.a,{className:"item-rating ".concat(e.value===l&&"active"," ").concat(u&&u!==e.value&&"unhover"),key:e.value,span:4,onMouseLeave:a.onMouseLeave,onMouseOver:function(){return a.hoverIcon(e.value)},onClick:function(){n.selectRating(e.value)}},L.a.createElement("img",{alt:"",src:e.icon,ref:a.image,onLoad:a.handleImageLoaded})))})))}),Object(p.a)(Object(m.a)(Object(m.a)(a)),"selectRating",function(e){a.state.rated||a.setState({rated:e,activeOrHover:e},function(){a.props.sendRate({messageId:a.props.message._id,rating:a.state.rated})})}),Object(p.a)(Object(m.a)(Object(m.a)(a)),"sendCSATFeedback",function(e){e.preventDefault(),T()(a.state.valueFeedback)||(a.setState({addedFeedback:!0}),a.props.sendFeedback({messageId:a.props.message._id,feedback:a.state.valueFeedback}))}),Object(p.a)(Object(m.a)(Object(m.a)(a)),"onChangeFeedback",function(e){a.setState({valueFeedback:e.target.value})}),Object(p.a)(Object(m.a)(Object(m.a)(a)),"renderFeedback",function(e){return e.meta.feedback?null===a.state.rated||a.state.addedFeedback||T()(a.state.rated)?a.state.addedFeedback?L.a.createElement("span",null,"".concat(ee.a.t("v\xe0 nh\u1eadn x\xe9t")," ").concat(a.state.valueFeedback)):null:L.a.createElement("div",{className:"input-feedback"},L.a.createElement(ae.a,{placeholder:ee.a.t("H\xe3y nh\u1eadp nh\u1eadn x\xe9t c\u1ee7a b\u1ea1n"),onChange:a.onChangeFeedback,value:a.state.valueFeedback,autoSize:{minRows:1,maxRows:3},onPressEnter:a.sendCSATFeedback}),L.a.createElement("div",{onClick:a.sendCSATFeedback,className:"btn-send-feedback"},L.a.createElement("img",{alt:"",src:"/images/icon-send.svg",ref:a.image,onLoad:a.handleImageLoaded}))):null}),Object(p.a)(Object(m.a)(Object(m.a)(a)),"openConversation",function(e,t){var n=A()(ne.f,{value:a.state.rated});(!T()(n)&&a.state.addedFeedback||!T()(n)&&!t.meta.feedback)&&a.props.openConversation(e)}),a.state={rated:null,valueFeedback:null,addedFeedback:!1,activeOrHover:null,loaded:!1},a.image=L.a.createRef(),a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.message;this.setState({activeOrHover:e.blocks[1].content,rated:e.blocks[1].content,valueFeedback:e.blocks[2].content,addedFeedback:!T()(e.blocks[2].content)})}},{key:"componentDidUpdate",value:function(){this.props.sendHeightPopup()}},{key:"render",value:function(){var e=this,t=this.props.message,a=t.blocks[0],n=this.state.rated,o=t.blocks[2];return L.a.createElement("li",{className:"chat-item "+t.author.type+" ms-status-"+t.status+" ms-csat"},L.a.createElement("div",{style:{position:"relative"}},L.a.createElement("div",{className:"border-rating theme-color-bg-non-hover"}),L.a.createElement("div",{className:"border-rating-popup"}),L.a.createElement("div",{className:"form"===t.blocks[0].contentType?"messages-item-inner wider":"messages-item-inner",onClick:function(){return e.openConversation(t.conversationId,o)}},L.a.createElement("div",{className:"avatar-name-msg-item"},L.a.createElement(J.a,{size:32,agent:t.author,className:"messages-item-avatar"}),L.a.createElement("div",{className:"agent-name"},t.author.lastName," ",t.author.firstName," ",t.author.isBot&&t.author.name)),L.a.createElement("div",{className:"message-content theme-color-bg-non-hover"},e.renderRating(a,o),!n&&L.a.createElement("div",{style:{height:"15px"}}),e.renderFeedback(o)))))}}]),t}(L.a.Component),se=(a(665),a(666)),re=a.n(se),ce=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o))),Object(p.a)(Object(m.a)(Object(m.a)(a)),"chooseBranch",function(e){a.props.chooseBranch(a.props.message,e)}),a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this.props.sendHeightPopup()}},{key:"render",value:function(){var e=this,t=this.props.message,a=P()(t,"blocks.0");return L.a.createElement("div",{className:"bot-notification-branching-group"},I()(a.meta.branches,function(t){return L.a.createElement(re.a,{className:"bot-notification-branching-button theme-color theme-color-border-non-hover theme-color-bg-hover",key:t.id,onClick:function(){return e.chooseBranch(t)}},t.text)}))}}]),t}(L.a.Component),ie=a(54),le=a(225),ue=function(e){function t(e){var a;return Object(c.a)(this,t),a=Object(l.a)(this,Object(u.a)(t).call(this,e)),Object(p.a)(Object(m.a)(Object(m.a)(a)),"sendHeightPopup",function(){if(a.divElement){var e=a.divElement.clientHeight;e!==a.lastSentHeight&&(a.lastSentHeight=e,Object(x.j)({height:a.divElement.clientHeight+80+"px",show:!!a.shownConversation}))}}),Object(p.a)(Object(m.a)(Object(m.a)(a)),"send",function(e){a.shownConversation&&a.props.sendText(a.shownConversation._id,a.shownConversation.conversationAssignedUUID,e).then(function(){return a.openConversation(a.shownConversation)})}),Object(p.a)(Object(m.a)(Object(m.a)(a)),"sendImage",function(e,t){a.shownConversation&&a.props.sendImage(a.shownConversation._id,a.shownConversation.conversationAssignedUUID,e,t).then(function(){return a.openConversation(a.shownConversation)})}),Object(p.a)(Object(m.a)(Object(m.a)(a)),"handleInteraction",function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("botAction"===t.type){var n=P()(e,"target.className","");t.isPositive=!n.includes("chat-close-button"),a.props.handleInteract(t)}}),Object(p.a)(Object(m.a)(Object(m.a)(a)),"chooseBranch",function(){var e=Object(r.a)(s.a.mark(function e(t,n,o){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.props.chooseBranch(t,n);case 2:a.openConversation(o);case 3:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}()),a.sendHeightPopup=a.sendHeightPopup.bind(Object(m.a)(Object(m.a)(a))),a.state={collapsed:!0,collapsible:!0},a.setIsShown=a.setIsShown.bind(Object(m.a)(Object(m.a)(a))),a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"setIsShown",value:function(e){var t=this;return function(){t.state.collapsed!==e&&t.setState({collapsed:e})}}},{key:"toggleCollapse",value:function(){this.state.collapsed?this.setState({collapsed:!1}):this.setState({collapsed:!0})}},{key:"componentWillUnmount",value:function(){this.heightCheck&&clearInterval(this.heightCheck)}},{key:"componentDidMount",value:function(){this.heightCheck=setInterval(this.sendHeightPopup,0)}},{key:"closeNotif",value:function(e){P()(e,"_id")&&(this.props.markAsRead(e._id),this.shownConversation=null,Object(x.e)())}},{key:"renderNotif",value:function(e){var t=this;if(T()(e))return null;var a=H()(e),n=A()(e,function(e){return"botAction"!==e.type}),o=this.state.collapsed;return L.a.createElement("div",{style:{paddingBottom:8},onClick:function(e){return t.handleInteraction(e,a)}},L.a.createElement("div",{className:"close-notif"},L.a.createElement("button",{className:"chat-close-button",onClick:this.closeNotif.bind(this,this.shownConversation)},L.a.createElement("img",{style:{pointerEvents:"none"},alt:"",src:"/images/icon-close.svg",width:9}))),L.a.createElement("ul",{id:"list-message",className:"list-message ".concat(o?"":"on-hover"," \n          list-message-total-").concat(n.length,"\n          ").concat(le.c.isOnMobile()?"mobile-mode":""),onMouseEnter:this.setIsShown(!1),onMouseLeave:this.setIsShown(!0)},I()(e,function(e){switch(e.type){case"csat":return L.a.createElement(oe,{sendHeightPopup:t.sendHeightPopup,openConversation:t.conversationClicked.bind(t,t.shownConversation),sendRate:t.props.sendCSATRate,sendFeedback:t.props.sendCSATFeedback,app:t.props.app,visitor:t.props.visitor,customFields:t.props.customFields,key:e._id,message:e});case"botAction":return L.a.createElement(ce,{sendHeightPopup:t.sendHeightPopup,chooseBranch:function(e,a){return t.chooseBranch(e,a,t.shownConversation)},key:e._id,message:e});default:return L.a.createElement(W,{app:t.props.app,sendHeightPopup:t.sendHeightPopup,openConversation:t.conversationClicked.bind(t,t.shownConversation),key:e._id,message:e})}})))}},{key:"conversationClicked",value:function(e){return this.state.collapsible&&this.state.collapsed?this.toggleCollapse():this.openConversation(e)}},{key:"openConversation",value:function(e){e&&(this.props.selectConversationByAssignedUUId(e.conversationAssignedUUID),this.props.toggle(),this.props.pageRedirect("conversation"))}},{key:"getRenderData",value:function(){var e=this.props,t=e.unreadConversations,a=e.unreadMessages,n=N()(t,function(e){return A()(a,function(t){return t.conversationId===e._id}).length?P()(e,"lastMessage.timestamps",0):0}),o=n?A()(a,function(e){return e.conversationId===n._id&&"form"!==P()(e,"blocks[0].contentType")}):[],s=C()(o,["timestamps"]).slice(-3);return this.shownConversation=T()(s)?null:n,s}},{key:"render",value:function(){var e=this,t=j()(this.props.unreadMessages),a=this.props.widgetOpen,n=this.getRenderData();return L.a.createElement(L.a.Fragment,null,L.a.createElement("div",{id:"popup",className:"popup"},t&&!a?L.a.createElement("span",{className:"show-number"},t>9?"9+":t):null,L.a.createElement("div",{ref:function(t){e.divElement=t}},this.renderNotif(n))))}}]),t}(L.a.Component);t.default=Object(_.connect)(function(e,t){var a=V.a.getTable(e,V.a.tableNames.messages),o=V.a.getMany(a,e.notification.unreadMessageIds),s=V.a.getTable(e,V.a.tableNames.conversations),r=V.a.getMany(s,e.notification.unreadConversationIds),c=V.a.getTable(e,V.a.tableNames.customFields);return Object(n.a)({unreadMessages:o,unreadConversations:O()(r,g.a)},e.notification,{widgetOpen:e.common.widgetOpen,customFields:V.a.query(c,{}),app:e.common.app,visitor:e.auth.visitor})},function(e){return{selectConversationByAssignedUUId:function(t){return e(D.b.selectConversationByAssignedUUID(t))},sendCSATRate:function(t){D.b.ratingConversation(t)(e)},toggle:v()(e,D.a.toggle),markAsRead:function(t){return e(D.d.markAsRead(t))},sendCSATFeedback:function(t){D.b.feedbackConversation(t)(e)},pageRedirect:function(t){e({type:"PAGE_REDIRECT",payload:t})},sendText:function(t,a,n){return e(D.d.sendText(t,a,n))},sendImage:v()(e,D.d.sendImage),chooseBranch:function(t,a){return e(ie.a.chooseBranch(t,a))},handleInteract:function(e){return ie.a.handleInteract(e)}}})(ue)}}]);